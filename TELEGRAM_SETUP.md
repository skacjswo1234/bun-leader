# 텔레그램 알림 설정 가이드

band-program 사이트에서 문의가 접수되면 텔레그램으로 실시간 알림을 받을 수 있습니다.

## 📋 설정 절차

### 1단계: 텔레그램 봇 생성

1. 텔레그램 앱에서 **@BotFather** 검색 및 대화 시작
2. `/newbot` 명령어 입력
3. 봇 이름 입력 (예: `분양리더 알림봇`)
   - 한글, 영문, 숫자, 공백 등 자유롭게 입력 가능
4. 봇 사용자명 입력 (예: `bunyang_leader_bot`)
   - ⚠️ **중요 규칙**:
     - 5-32자 길이
     - 영문자, 숫자, 언더스코어(_)만 사용 가능
     - 반드시 영문자로 시작해야 함
     - 한글, 특수문자, 공백 사용 불가
     - 이미 사용 중인 이름이면 안 됨
   - ✅ **추천 사용자명** (순서대로 시도):
     1. `bunyang_bot` (가장 간단)
     2. `bunyang_notify_bot`
     3. `bunyang_alert_bot`
     4. `bunyang_leader_bot`
     5. `bunyang123_bot` (숫자 추가)
     6. `bunyangleader_bot` (언더스코어 제거)
   - ❌ **잘못된 예시**: `분양리더봇` (한글), `bunyang-bot` (하이픈), `123bot` (숫자로 시작)
   - 💡 **팁**: 사용자명이 이미 사용 중이면 다른 이름을 시도하세요. 더 짧고 간단한 이름일수록 사용 가능할 확률이 높습니다.
5. **봇 토큰(Bot Token)** 발급받기 (예: `123456789:ABCdefGHIjklMNOpqrsTUVwxyz`)

> ⚠️ **중요**: 봇 토큰은 절대 공개하지 마세요!

### 2단계: 채팅 ID 확인

채팅 ID는 텔레그램에서 알림을 받을 채팅방을 식별하는 고유 번호입니다.

#### 방법 1: 개인 채팅 사용 (가장 간단, 추천)

**단계별 가이드:**

1. **봇 찾기**
   - 텔레그램 앱을 엽니다
   - 검색창에서 봇 사용자명을 검색합니다: `@bunyang_alert_bot`
   - 또는 직접 링크로 접속: https://t.me/bunyang_alert_bot
   - 봇을 선택하여 대화를 시작합니다

2. **봇에게 메시지 보내기**
   - 봇과의 대화창에서 아무 메시지나 보냅니다
   - 예: "안녕", "테스트", "hello" 등
   - 봇이 응답하지 않아도 괜찮습니다

3. **채팅 ID 확인하기**
   - 브라우저를 엽니다 (Chrome, Edge 등)
   - 아래 URL을 주소창에 **그대로 복사해서** 입력합니다:
     ```
     https://api.telegram.org/bot8536508891:AAEo1rqt1sZ-m1Ra1WBfpaKwIzmuDeKjQLI/getUpdates
     ```
   
   > 💡 **참고**: 위 URL은 1단계에서 받은 실제 봇 토큰이 포함되어 있습니다. 다른 봇을 사용하는 경우 토큰 부분만 교체하세요.
   
   - Enter 키를 눌러 접속합니다

4. **응답 확인하기**
   
   **✅ 정상 응답인 경우:**
   - 화면에 JSON 형식의 데이터가 표시됩니다
   - `"ok":true`가 보입니다
   
   **❌ 응답이 비어있거나 에러가 나는 경우:**
   
   **케이스 1: `"result":[]` (빈 배열)**
   ```
   {
     "ok": true,
     "result": []
   }
   ```
   - **해결 방법**: 봇에게 메시지를 보낸 후 URL을 다시 새로고침(F5)하세요
   - 봇과 대화를 시작했는지 확인하세요
   
   **케이스 2: 아무것도 안 보이거나 페이지가 로드되지 않음**
   - **해결 방법 1**: URL을 다시 한 번 정확히 복사해서 입력하세요
   - **해결 방법 2**: 브라우저를 새로고침(F5)하세요
   - **해결 방법 3**: 다른 브라우저로 시도해보세요 (Chrome, Edge, Firefox)
   - **해결 방법 4**: 인터넷 연결을 확인하세요
   
   **케이스 3: `"ok":false` 또는 에러 메시지**
   ```
   {
     "ok": false,
     "error_code": 401,
     "description": "Unauthorized"
   }
   ```
   - **해결 방법**: 봇 토큰이 잘못되었을 수 있습니다. 1단계에서 받은 토큰을 다시 확인하세요

5. **응답에서 채팅 ID 찾기**
   - 화면에 JSON 형식의 데이터가 표시됩니다
   - `"chat"` 라는 단어를 찾습니다 (Ctrl+F로 검색 가능)
   - `"chat":{"id":123456789}` 형태의 부분을 찾습니다
   - `id` 뒤의 숫자 (예: `123456789`)가 **채팅 ID**입니다
   
   **예시 응답:**
   ```json
   {
     "ok": true,
     "result": [
       {
         "message": {
           "chat": {
             "id": 7697989545,  ← 이것이 채팅 ID입니다!
             "first_name": "TMACS",
             "type": "private"
           }
         }
       }
     ]
   }
   ```
   
   **실제 응답 예시:**
   - 응답에서 `"chat":{"id":7697989545}` 형태를 찾으세요
   - `id` 뒤의 숫자 `7697989545`가 **채팅 ID**입니다
   - 여러 메시지가 있어도 모두 같은 채팅 ID를 가집니다

6. **채팅 ID 복사하기**
   - 찾은 숫자를 복사하거나 메모해둡니다
   - 예: `123456789`

> ⚠️ **중요**: 
> - **반드시 봇에게 메시지를 보낸 후** URL에 접속해야 합니다
> - 메시지를 보내지 않으면 `"result":[]`로 나올 수 있습니다
> - URL 접속 후 아무것도 안 보이면 F5로 새로고침하세요

#### 방법 2: 그룹 채팅 사용 (여러 명이 알림 받을 때)

**단계별 가이드:**

1. **그룹 생성**
   - 텔레그램에서 새 그룹을 만듭니다
   - 그룹 이름을 입력합니다 (예: "분양리더 알림")

2. **봇을 그룹에 추가**
   - 그룹 설정 → 멤버 추가
   - 생성한 봇을 검색하여 추가합니다

3. **그룹에서 메시지 보내기**
   - 그룹 채팅에서 아무 메시지나 보냅니다
   - 예: "테스트"

4. **채팅 ID 확인하기**
   - 방법 1과 동일하게 `getUpdates` URL로 접속합니다
   - 응답에서 `"chat":{"id":-1001234567890}` 형태를 찾습니다
   - **그룹 채팅 ID는 음수입니다** (예: `-1001234567890`)
   - 이 숫자가 그룹의 **채팅 ID**입니다

> ⚠️ **주의**: 그룹 채팅 ID는 음수로 시작하며, 앞에 `-100`이 붙는 경우가 많습니다.

### 3단계: Cloudflare Pages 환경 변수 설정

Cloudflare Pages에 텔레그램 봇 정보를 등록하여 알림 기능을 활성화합니다.

**단계별 가이드:**

1. **Cloudflare Dashboard 접속**
   - https://dash.cloudflare.com 접속
   - 로그인합니다

2. **프로젝트 선택**
   - 왼쪽 메뉴에서 **Pages** 클릭
   - `bun-leader` 프로젝트를 선택합니다

3. **환경 변수 설정 페이지로 이동**
   - 상단 메뉴에서 **Settings** 탭 클릭
   - 왼쪽 사이드바에서 **Environment Variables** 클릭

4. **환경 변수 추가**
   - **Add variable** 버튼을 클릭합니다
   - 다음 두 개의 변수를 각각 추가합니다:

   **첫 번째 변수:**
   - **Variable name**: `TELEGRAM_BOT_TOKEN`
   - **Value**: 아래 봇 토큰을 **그대로 복사해서** 입력합니다
     ```
     8536508891:AAEo1rqt1sZ-m1Ra1WBfpaKwIzmuDeKjQLI
     ```
   - **Add** 클릭

   **두 번째 변수:**
   - **Variable name**: `TELEGRAM_CHAT_ID`
   - **Value**: 2단계에서 확인한 채팅 ID 입력
     - 예: `7697989545` (개인 채팅) 또는 `-1001234567890` (그룹 채팅)
     - **실제 채팅 ID**: `7697989545` (위 응답에서 확인한 값)
   - **Add** 클릭

5. **변수 확인**
   - 두 변수가 모두 추가되었는지 확인합니다:
     - ✅ `TELEGRAM_BOT_TOKEN`
     - ✅ `TELEGRAM_CHAT_ID`

6. **재배포**
   - 상단 메뉴에서 **Deployments** 탭 클릭
   - 가장 최근 배포를 찾습니다
   - 오른쪽 **...** 메뉴 클릭 → **Retry deployment** 선택
   - 또는 새로운 코드를 푸시하면 자동으로 재배포됩니다

> ⚠️ **중요**: 
> - 환경 변수는 재배포 후에만 적용됩니다
> - 변수를 추가/수정한 후 반드시 재배포해야 합니다
> - 봇 토큰과 채팅 ID는 정확하게 입력해야 알림이 작동합니다

### 4단계: 테스트

1. band-program 사이트에서 문의 폼 작성 및 제출
2. 텔레그램으로 알림 메시지 수신 확인

## 📱 알림 메시지 형식

```
🔔 새로운 문의가 접수되었습니다!

📌 사이트: band-program
👤 이름: 홍길동
📞 연락처: 010-1234-5678
💬 메시지:
안녕하세요, 문의드립니다.

📋 추가 정보:
• 문의타입: 홍보대행
• 상품유형: 밴드프로그램 - 일반버전(100만원)

⏰ 접수 시간: 2024. 1. 15. 오후 3:30:45
```

## 🔧 문제 해결

### "Sorry, this username is invalid." 오류

이 오류는 봇 사용자명이 텔레그램 규칙을 위반했을 때 발생합니다.

**해결 방법:**
1. 봇 사용자명 규칙 확인:
   - ✅ 5-32자 길이
   - ✅ 영문자, 숫자, 언더스코어(_)만 사용
   - ✅ 반드시 영문자로 시작
   - ❌ 한글, 특수문자, 공백 사용 불가
   - ❌ 이미 사용 중인 이름 사용 불가

2. 올바른 사용자명 예시:
   - `bunyang_leader_bot`
   - `bunyang_bot`
   - `leader_notify_bot`
   - `bunyang123_bot`

3. 잘못된 사용자명 예시:
   - `분양리더봇` (한글 사용)
   - `bunyang-bot` (하이픈 사용)
   - `123bot` (숫자로 시작)
   - `bun yang bot` (공백 사용)

4. 다른 사용자명으로 다시 시도:
   - `/newbot` 명령어를 다시 입력
   - 더 간단한 사용자명부터 시도:
     - `bunyang_bot` (가장 추천)
     - `bunyang_notify_bot`
     - `bunyang_alert_bot`
     - `bunyang123_bot`
   - 사용자명 끝에 숫자나 다른 단어를 추가해보세요

### 알림이 오지 않는 경우

1. **환경 변수 확인**
   - Cloudflare Pages 환경 변수가 올바르게 설정되었는지 확인
   - 변수명이 정확한지 확인 (`TELEGRAM_BOT_TOKEN`, `TELEGRAM_CHAT_ID`)

2. **봇 토큰 확인**
   - 봇 토큰이 올바른지 확인
   - 봇이 비활성화되지 않았는지 확인

3. **채팅 ID 확인**
   - 채팅 ID가 올바른지 확인
   - 봇과 대화를 시작했는지 확인 (개인 채팅의 경우)
   - 봇이 그룹에 추가되었는지 확인 (그룹 채팅의 경우)

4. **로그 확인**
   - Cloudflare Dashboard → **Workers & Pages** → **Logs**에서 에러 확인

### 테스트 방법

브라우저 콘솔에서 직접 테스트:

```javascript
// Cloudflare Pages Functions에서 실행
const response = await fetch('https://api.telegram.org/bot<YOUR_BOT_TOKEN>/sendMessage', {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({
    chat_id: '<YOUR_CHAT_ID>',
    text: '테스트 메시지'
  })
});
```

## 📚 참고 자료

- [텔레그램 Bot API 문서](https://core.telegram.org/bots/api)
- [BotFather 사용법](https://core.telegram.org/bots/tutorial)

